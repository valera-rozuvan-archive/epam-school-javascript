<html>
  <head>
    <title>Sample JavaScript code</title>
  </head>
  <body>
    <div id="some_text">Hello, world</div>

    <script type="text/javascript">
      // Execute a callback function when DOM is loaded.
      function ready(callback) {
        if (document.readyState != 'loading'){
          callback();
        } else {
          document.addEventListener('DOMContentLoaded', callback);
        }
      }

      // Main entry point of our code. All sample code should be placed
      // in this function.
      function main() {
        var promise;

        function getData() {
          var data, promise = $.createPromise();

          (function () {
            // populate data from server
            data = {};


            // promise.resolve();

            // promise.__resolved = true
            // promise.__success = true
            // all success callbacks => execute

            promise.reject();

            // promise.__resolved = true
            // promise.__success = false
            // all failed callbacks => execute
          }());

          return promise;
        }

        promise = getData();

        // promise.__resolved === false
        promise.success(doSomethngElse);
        promise.success(doSomethingWithData);

        promise.fail(callbackFail);

        promise.dataModifier(function (data) {
          if () {
            data.club = 1;
          }
        });

        promise
          .then(function (data) {
            data.club = 1;

            return data;
          }).then(function (data) {
            // data.club === 1
          });

        /// ...
        // promise.__resolve === true
        promise.success(func3);

        function doSomethingWithData(data) {
          console.log(data);
        }

        function doSomethingElse(data) {

        }
      }

      // Call the function main() when DOM is loaded.
      ready(main);
    </script>
  </body>
</html>
